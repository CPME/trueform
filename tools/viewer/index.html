<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Trueform Viewer</title>
    <style>
      :root {
        color-scheme: light;
      }
      html,
      body {
        margin: 0;
        height: 100%;
        background: #f6f2ea;
        color: #1a1a1a;
        font-family: "Iowan Old Style", "Garamond", "Times New Roman", serif;
      }
      #app {
        position: relative;
        height: 100%;
        width: 100%;
      }
      .ref-overlay {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        max-width: none;
        max-height: none;
        pointer-events: none;
        opacity: 0.4;
        mix-blend-mode: multiply;
      }
      .ref-overlay.hidden {
        display: none;
      }
      canvas {
        display: block;
        width: 100vw;
        height: 100vh;
      }
      .hud {
        position: absolute;
        top: 16px;
        left: 16px;
        padding: 10px 12px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.85);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        font-size: 14px;
        max-width: min(480px, calc(100vw - 32px));
      }
      .hud code {
        font-family: "SFMono-Regular", "Menlo", "Monaco", "Consolas", "Liberation Mono",
          "Courier New", monospace;
        font-size: 12px;
      }
      .hud .title {
        font-weight: 600;
        margin-bottom: 6px;
      }
      .hud .status {
        margin-bottom: 10px;
      }
      .controls {
        display: grid;
        gap: 8px;
      }
      .controls label {
        display: grid;
        gap: 6px;
        font-size: 12px;
        color: #4a4037;
      }
      .controls input[type="file"] {
        font-size: 12px;
      }
      .controls .row {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 6px;
      }
      .controls .row-2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 6px;
      }
      .controls input[type="text"] {
        border: 1px solid #c9bfb3;
        border-radius: 6px;
        padding: 6px 8px;
        font-size: 12px;
        background: #fffdf9;
      }
      .controls select {
        border: 1px solid #c9bfb3;
        border-radius: 6px;
        padding: 6px 8px;
        font-size: 12px;
        background: #fffdf9;
      }
      .controls button {
        border: 1px solid #b9a896;
        background: #f4efe8;
        border-radius: 6px;
        padding: 6px 10px;
        font-size: 12px;
        cursor: pointer;
      }
      .controls button:hover {
        background: #efe6dc;
      }
      .controls input[type="range"] {
        width: 100%;
      }
      .overlay-block {
        border-top: 1px solid #e3dbd0;
        padding-top: 8px;
      }
      .overlay-title {
        font-size: 12px;
        font-weight: 600;
        color: #4a4037;
      }
      .selector-panel {
        margin-top: 10px;
        padding: 8px 10px;
        border-radius: 6px;
        border: 1px solid #d8cfc4;
        background: #fffdf9;
        font-size: 11px;
        max-height: 200px;
        overflow: auto;
        color: #3b332b;
        white-space: pre-wrap;
      }
      .selector-panel .selector-title {
        font-weight: 600;
        margin-bottom: 4px;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <canvas id="viewport"></canvas>
      <img id="ref-overlay" class="ref-overlay hidden" alt="Reference overlay" />
      <div class="hud">
        <div class="title">TrueForm Viewer</div>
        <div class="status" id="status">Loadingâ€¦</div>
        <div class="controls">
          <label>
            Assets
            <div class="row">
              <select id="asset-select"></select>
              <button id="load-asset" type="button">Load</button>
            </div>
          </label>
          <label>
            Load local mesh JSON
            <input type="file" id="file-input" accept=".json,application/json" />
          </label>
          <div class="row">
            <input
              type="text"
              id="file-url"
              placeholder="./assets/plate.mesh.json"
            />
            <button id="load-url" type="button">Load</button>
          </div>
          <div class="overlay-block">
            <div class="overlay-title">Runtime API</div>
            <label>
              API Base URL
              <input
                type="text"
                id="api-url"
                placeholder="http://127.0.0.1:8080"
              />
            </label>
            <button id="build-api" type="button">Build via API</button>
          </div>
          <button id="download-png" type="button">Download PNG</button>
          <div class="overlay-block">
            <div class="overlay-title">Reference Overlay</div>
            <label>
              Load image
              <input type="file" id="ref-input" accept="image/*" />
            </label>
            <div class="row">
              <input type="text" id="ref-url" placeholder="https://.../drawing.png" />
              <button id="load-ref" type="button">Load</button>
            </div>
            <label>
              Opacity
              <input type="range" id="ref-opacity" min="0" max="1" step="0.01" value="0.4" />
            </label>
            <label>
              Scale
              <input type="range" id="ref-scale" min="0.1" max="3" step="0.01" value="1" />
            </label>
            <div class="row-2">
              <label>
                Offset X
                <input type="text" id="ref-offset-x" value="0" />
              </label>
              <label>
                Offset Y
                <input type="text" id="ref-offset-y" value="0" />
              </label>
            </div>
            <label>
              Rotation (deg)
              <input type="text" id="ref-rotation" value="0" />
            </label>
            <button id="clear-ref" type="button">Clear Overlay</button>
          </div>
        </div>
        <div class="selector-panel" id="selector-panel">
          <div class="selector-title">Selectors</div>
          <div id="selector-info">Selectors disabled. Add ?selectors=1</div>
        </div>
      </div>
    </div>
    <script type="importmap">
      {
        "imports": {
          "three": "./node_modules/three/build/three.module.js",
          "three/examples/jsm/": "./node_modules/three/examples/jsm/",
          "fflate": "./node_modules/fflate/esm/browser.js"
        }
      }
    </script>
    <script type="module" src="./viewer.js"></script>
  </body>
</html>
